---
title: "Species_Name_Check"
output: html_document
---

```{r}
# setup
rm(list = ls())
require("raster")
setwd("/Users/boterolab1/Box Sync/JMPH_2020")


# helper function
'%notin%' <- Negate('%in%')


# load the birdPAM and just retain the species names.
load(file = "BirdPAM.Rdata")
pam_names <- colnames(myPAM$Presence_and_Absence_Matrix)
myPAM <- NULL
pam_names <- gsub(" ", "_", pam_names)
save(pam_names, file = "PAM_Names.Rdata")

setwd("/Users/boterolab1/Box Sync/JMPH_2020/")

# load the cooney dataset and get the names
cooney <- read.csv("Cooney_Pair_Data.csv", header = T, stringsAsFactors = F)
cooney <- cooney[cooney$Tree == "mcc",]
sum(sort(unique(cooney$Species.1)) %in% sort(unique(cooney$Species.2))) # check: each species is only in the dataframe once...so need to get names for list1 and list2
cooney_names <- c(cooney$Species.1, cooney$Species.2)
length(unique(cooney_names)) == length(cooney_names) # all names are unique
cooney <- NULL
save(cooney_names, file = "Cooney_Names.Rdata")

# load Angela's name key
setwd("/Users/boterolab1/Box Sync/JMPH_2020/")
key_a <- read.csv(file = "all_birdlife_species.csv", stringsAsFactors = F)
key_a[,1] <- gsub(" ", "_", key_a[,1])
key_a[,4] <- gsub(" ", "_", key_a[,4])

# load Justin's name key
setwd("/Users/boterolab1/Box Sync/JMPH_2020/")
key_j <- read.csv(file = "master_migrant_pam_table_manually_cleaned.csv", stringsAsFactors = F)

# get nomatch names
# matchednames <- cooney_names[cooney_names %notin% pam_names]
matchednames <- cooney_names
matchednames <- as.data.frame(matchednames, stringsAsFactors =F)
colnames(matchednames) <- "cooney_name"
matchednames$a_BL_latin_1 <- NA
matchednames$a_BL_latin_2 <- NA
matchednames$j_BLI_1 <- NA
matchednames$j_BLI_2 <- NA

# populate name match columns
for (i in 1:nrow(matchednames)) {
  matchednames$a_BL_latin_1[i] <- key_a$BL_latin[key_a$matching.btree_spp == matchednames$cooney_name[i]][1]
  matchednames$a_BL_latin_2[i] <- key_a$BL_latin[key_a$matching.btree_spp == matchednames$cooney_name[i]][2]
  matchednames$j_BLI_1[i] <- key_j$BLI[key_j$eyres == matchednames$cooney_name[i]][1]
  matchednames$j_BLI_2[i] <- key_j$BLI[key_j$eyres == matchednames$cooney_name[i]][2]
}

# ensure that order is sorted for species with two names
for (i in 1:nrow(matchednames)){
  a <- matchednames$a_BL_latin_1[i]
  b <- matchednames$a_BL_latin_2[i]
  ab <- c(a,b)
  ab <- sort(ab)
  matchednames$a_BL_latin_1[i] <- ab[1]
  matchednames$a_BL_latin_2[i] <- ab[2]
}

matchednames$dupcheck <- paste0(matchednames$a_BL_latin_1, matchednames$a_BL_latin_2)
matchednames$dup <- F
matchednames$dup[duplicated(matchednames$dupcheck)] <- T
matchednames$order <- seq(1, nrow(matchednames))
matchednames <- matchednames[seq(dim(matchednames)[1],1),]
matchednames$dup[duplicated(matchednames$dupcheck)] <- T
length(unique(matchednames$dupcheck)) # remove 8 entries that have two cooney sp names with the same latin name (looking at both latin name 1 and 2)

save(matchednames, file = "Matched_Names.Rdata")
```
